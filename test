#include "MyHeader.h"

clock_t start_time;
clock_t end_time;
extern curtime;

int game_over_flag = 0;
int curPosX, curPosY;
int humanCurPosX = 50, humanCurPosY = 15;
int virusCurPosX, virusCurPosY;
int mode;
int next = 0;
int curTime;

int v_num = 0;
int vertical_num = 0;

int clock_item_flag = 0;
int phoenix_item_flag = 0;
int life_item_flag = 0;

int trackingVirus_flag = 0;
int trackingVirusOneby_flag = 0;
int trackingVirusVertical_flag = 0;

int clockCurPosX = 0, clockCurPosY = 0;
int clock_item_time;
int clock_item_time_plus_5sec;


int phoenixCurPosX = 0, phoenixCurPosY = 0;
int phoenix_item_time;
int phoenix_item_time_plus_5sec;

int lifeCurPosX = 0, lifeCurPosY = 0;
int check = 0;


int main() {
	int i, j, num_cnt = 0;
	int vertical_cnt = 0;
	int circle_cnt = 0;

	system("mode con:cols=130 lines=30");   // cols: 가로, lines: 세로
	removeCursor();
	selectMode();
	_beginthreadex(NULL, 0, ThreadTime, 0, 0, NULL);
	WHITE
	start_time = clock();
	createTime();
	createLife();

	//createHuman();
	createVirus();

	_beginthreadex(NULL, 0, moveHuman, 0, 0, NULL);

	while (1) {
		int i = 1;

		/*if (_kbhit())
			moveHuman();*/

		Sleep(200);

		/*if (_kbhit())
			moveHuman();*/

		if (i % 100 == 0) {
			num_cnt++;
		}

		for (j = 0; j <= num_cnt; j++)
		{
			createVirusOneby();
		}

		trackingVirus();
		trackingVirusOneby();

		check = DetectCollisionV();
		if (check == 2) {
			if (phoenix_item_flag == 0 || phoenix_item_flag == 1) {
				game_util.life = --game_util.life;
				updateLife();
				/*SetCurrentCursorPos(humanCurPosX, humanCurPosY);
				RED printf("∩\a");*/
			}

			if (game_util.life == 0) {
				game_over_flag = 1;
				GameOver();
				break;
			}
			Sleep(700);
		}

		/*if (check == 2) {
			WHITE
			SetCurrentCursorPos(humanCurPosX, humanCurPosY);
			printf("  ");
			createHuman();
			check = 0;
		}*/

		if (vertical_num == 10) {
			createVirusVertical();
			//createVirusCircle();
			//createVirusSquare();
			vertical_cnt++;
		}

		if (vertical_cnt >= 1) {
			trackingVirusVertical();
		}

		Sleep(1000);
		i++;
		end_time = clock();
		clock_item();
		phoenix_item();
		life_item();
	}

	getchar();
	return 0;
}
